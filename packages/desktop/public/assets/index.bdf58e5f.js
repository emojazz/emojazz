var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,s=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&r(e,a,t[a]);if(n)for(var a of n(t))i.call(t,a)&&r(e,a,t[a]);return e},l=(e,t)=>{var a={};for(var r in e)o.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&n)for(var r of n(e))t.indexOf(r)<0&&i.call(e,r)&&(a[r]=e[r]);return a};import{_ as c,j as d,M as u,l as m,y as p,a as g,b as f,h,N as y}from"./vendor.47d0e1ba.js";window.goLoadSearch=async()=>fetch("/api/search",{method:"POST"}).then((e=>e.text())),window.goLoadImage=async()=>fetch("/api/image",{method:"POST"}).then((e=>e.text()));const v={unicode:c.list(c.string()),categories:c.list(c.string()),description:c.object().additionalProperties(c.string()),tag:c.list(c.string())},w=c.shape(v);let b,N;async function j(){return b=b||c.object().additionalProperties(w).ensure(d.load(await window.goLoadSearch())),b}async function O(){void 0===N&&(N=c.object().additionalProperties(c.list(c.string())).ensure(d.load(await window.goLoadImage())))}async function L(e){const n=(await j())[e.id];return n?(await O(),o=s({},n),i={images:N[e.id]||[]},t(o,a(i))):null;var o,i}const S={fields:["id","u","c","d","t"],storeFields:["id"],searchOptions:{boost:{t:5,c:2},prefix:!0,combineWith:"AND"}};let x;async function P(){const e=await j();void 0===x&&(x=new u(S),await x.addAllAsync(Object.entries(e).map((([e,t])=>({id:e,u:t.unicode,c:t.categories,d:Object.values(t.description).join("\n"),t:t.tag})))))}function C(){const[e,t]=m([]),[a,n]=m(""),[o,i]=m(1),[r,c]=m(0),[d,u]=m(!1),[y,v]=m(!1),[w,b]=m(""),[N,S]=m({images:[]}),[C,I]=m("Noto Color Emoji"),[T,D]=m(C),q=h(),A=(e={})=>{y?setTimeout((()=>{A(e)}),500):(v(!0),(async()=>{a.trimStart()||(i(1),t([]));const n=await async function(e){let{q:t=""}=e;if(t=t.trimLeft(),!t)return{result:[],count:0};const a=await j();await P();const{page:n=1,limit:o=50}=e,i=x.search(t);return{result:i.map((e=>s({text:e.id},a[e.id]))).slice((n-1)*o,n*o),count:i.length}}({q:a,page:o,limit:100});console.log(n),n.count||(i(1),t([]));const r=[...e.prev||[],...n.result];if(t(r),c(n.count),e.prev){const t=new Set(e.prev),a=n.result.filter((e=>t.has(e.text)));a.length&&console.error("Duplicates: ",a)}})().finally((()=>{v(!1)})))};return p((()=>{A()}),[a]),p((()=>{A({prev:e})}),[o]),p((()=>{const t=q.current;t&&(t.onscroll=()=>{e.length<r&&t.scrollHeight-t.scrollTop-t.clientHeight<50&&i(o+1)},t.scrollHeight<=t.clientHeight&&(t.scrollTop=0,i(1)))}),[o,e]),p((()=>{w&&L({id:w}).then((e=>{S(e||{images:[]})}))}),[w]),p((()=>{Promise.all([O(),P()]).then((()=>{u(!0)})),window.onkeydown=e=>{"Escape"===e.code&&b("")}})),g(f,null,g("form",{className:"search",onSubmit:async e=>{e.preventDefault()}},g("input",{type:"search",name:"q",id:"q",value:a,onInput:e=>n(e.target.value)})),g("div",{className:"container",ref:q},e.length?e.map((e=>{var t=e,{text:a}=t,n=l(t,["text"]);return g("div",{className:"emoji",title:k(n),onClick:()=>{D(C),b(a)}},a)})):1===o?g("div",{class:"nothing"},"Nothing here ðŸ¤£ðŸ¤£ðŸ¤£"):null),d?null:g("div",{className:"modal-container",style:{backgroundColor:"#88888833"}},g("div",{className:"spin"})),w?g("div",{className:"modal-container",onClick:()=>b("")},g("div",{className:"modal",onClick:e=>e.stopPropagation()},g("button",{className:"delete",type:"button",onClick:()=>b("")},g("div",{className:"emoji"},"âœ•")),g("div",{className:"row",style:{alignItems:"center"}},g("span",{style:{fontSize:"1.3em"}},"Text:"),g("span",null," "),/^https?:\/\//i.test(w)?(()=>{let e=w;return e.toLocaleLowerCase().startsWith(location.origin.toLocaleLowerCase())&&(e=e.substr(location.origin.length)),g("div",{className:"entry",title:"Right click to copy the image"},g("img",{src:w,alt:w}))})():g("span",{className:"entry",style:{fontFamily:C}},w)),g("div",{className:"row"},N.images.map((e=>(e.toLocaleLowerCase().startsWith(location.origin.toLocaleLowerCase())&&(e=e.substr(location.origin.length)),g("div",{className:"entry",title:"Right click to copy the image"},g("img",{src:e,alt:e})))))),g("form",{className:"row font",onSubmit:async e=>{e.preventDefault(),I(T)},style:{alignItems:"center"}},g("label",{for:"font",style:{fontSize:"1.3em"}},"Font:"),g("input",{type:"text",name:"font",id:"font",value:T,onInput:e=>D(e.target.value),placeholder:"Set alternate font here"}),g("div",{style:{position:"relative"}},g("button",{type:"submit"},"âœ…"))),g("pre",{className:"row",style:{textAlign:"left"}},(e=>{var t=e,{images:a}=t;return k(l(t,["images"]))})(N)))):null)}function k(e){return d.dump(e,{replacer:(e,t)=>{if(String(t))return t},skipInvalid:!0})}y(g(C,null),document.getElementById("app"));
