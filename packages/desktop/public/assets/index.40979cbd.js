var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,s=(e,t)=>{for(var n in t||(t={}))i.call(t,n)&&r(e,n,t[n]);if(a)for(var n of a(t))o.call(t,n)&&r(e,n,t[n]);return e},l=(e,t)=>{var n={};for(var r in e)i.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&a)for(var r of a(e))t.indexOf(r)<0&&o.call(e,r)&&(n[r]=e[r]);return n};import{_ as c,j as d,M as u,l as m,y as p,a as g,b as f,h as v,N as y}from"./vendor.47d0e1ba.js";window.goLoadSearch=async()=>fetch("/api/search",{method:"POST"}).then((e=>e.text())),window.goLoadImage=async()=>fetch("/api/image",{method:"POST"}).then((e=>e.text()));const h={unicode:c.list(c.string()),categories:c.list(c.string()),description:c.object().additionalProperties(c.string()),tag:c.list(c.string())},w=c.shape(h);let b,N;async function j(){return b=b||c.object().additionalProperties(w).ensure(d.load(await window.goLoadSearch())),b}async function O(){void 0===N&&(N=c.object().additionalProperties(c.list(c.string())).ensure(d.load(await window.goLoadImage())))}async function S(e){const a=(await j())[e.id];return a?(await O(),i=s({},a),o={images:N[e.id]||[]},t(i,n(o))):null;var i,o}const x={fields:["id","u","c","d","t"],storeFields:["id"],searchOptions:{boost:{t:5,c:2},prefix:!0,combineWith:"AND"}};let P;async function I(){const e=await j();void 0===P&&(P=new u(x),await P.addAllAsync(Object.entries(e).map((([e,t])=>({id:e,u:t.unicode,c:t.categories,d:Object.values(t.description).join("\n"),t:t.tag})))))}function k(){const[e,t]=m([]),[n,a]=m(""),[i,o]=m(1),[r,c]=m(0),[d,u]=m(!1),[y,h]=m(!1),[w,b]=m(""),[N,x]=m({images:[]}),[k,T]=m("Noto Color Emoji"),[D,L]=m(k),q=v(),A=(e={})=>{y?setTimeout((()=>{A(e)}),500):(h(!0),(async()=>{n.trimStart()||(o(1),t([]));const a=await async function(e){let{q:t=""}=e;if(t=t.trimLeft(),!t)return{result:[],count:0};const n=await j();await I();const{page:a=1,limit:i=50}=e,o=P.search(t);return{result:o.map((e=>s({text:e.id},n[e.id]))).slice((a-1)*i,a*i),count:o.length}}({q:n,page:i,limit:100});console.log(a),a.count||(o(1),t([]));const r=[...e.prev||[],...a.result];if(t(r),c(a.count),e.prev){const t=new Set(e.prev),n=a.result.filter((e=>t.has(e.text)));n.length&&console.error("Duplicates: ",n)}})().finally((()=>{h(!1)})))};return p((()=>{A()}),[n]),p((()=>{A({prev:e})}),[i]),p((()=>{const t=q.current;t&&(t.onscroll=()=>{e.length<r&&t.scrollHeight-t.scrollTop-t.clientHeight<50&&o(i+1)},t.scrollHeight<=t.clientHeight&&(t.scrollTop=0,o(1)))}),[i,e]),p((()=>{w&&S({id:w}).then((e=>{x(e||{images:[]})}))}),[w]),p((()=>{Promise.all([O(),I()]).then((()=>{u(!0)})),window.onkeydown=e=>{"Escape"===e.code&&b("")}})),g(f,null,g("form",{className:"search",onSubmit:async e=>{e.preventDefault()}},g("input",{type:"search",name:"q",id:"q",value:n,onInput:e=>a(e.target.value)})),g("div",{className:"container",ref:q},e.length?e.map((e=>{var t=e,{text:n}=t,a=l(t,["text"]);return g("div",{className:"emoji",title:C(a),onClick:()=>{L(k),b(n)}},n)})):1===i?g("div",{class:"nothing"},"Nothing here ðŸ¤£ðŸ¤£ðŸ¤£"):null),d?null:g("div",{className:"modal-container",style:{backgroundColor:"#88888833"}},g("div",{className:"spin"})),w?g("div",{className:"modal-container",onClick:()=>b("")},g("div",{className:"modal",onClick:e=>e.stopPropagation()},g("button",{className:"delete",type:"button",onClick:()=>b("")},g("div",{className:"emoji"},"âœ•")),g("div",{className:"row",style:{alignItems:"center"}},g("span",{style:{fontSize:"1.3em"}},"Text:"),g("span",{className:"entry",style:{fontFamily:k}},w)),g("div",{className:"row"},N.images.map((e=>g("div",{className:"entry",title:"Right click to copy the image"},g("img",{src:e,alt:e}))))),g("form",{className:"row font",onSubmit:async e=>{e.preventDefault(),T(D)},style:{alignItems:"center"}},g("label",{for:"font",style:{fontSize:"1.3em"}},"Font:"),g("input",{type:"text",name:"font",id:"font",value:D,onInput:e=>L(e.target.value),placeholder:"Set alternate font here"}),g("div",{style:{position:"relative"}},g("button",{type:"submit"},"âœ…"))),g("pre",{className:"row",style:{textAlign:"left"}},(e=>{var t=e,{images:n}=t;return C(l(t,["images"]))})(N)))):null)}function C(e){return d.dump(e,{replacer:(e,t)=>{if(String(t))return t},skipInvalid:!0})}y(g(k,null),document.getElementById("app"));
