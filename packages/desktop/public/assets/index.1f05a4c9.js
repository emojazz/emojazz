var t=Object.defineProperty,e=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,s=(e,n,o)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,r=(t,e)=>{for(var n in e||(e={}))a.call(e,n)&&s(t,n,e[n]);if(o)for(var n of o(e))i.call(e,n)&&s(t,n,e[n]);return t},l=(t,e)=>{var n={};for(var s in t)a.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(null!=t&&o)for(var s of o(t))e.indexOf(s)<0&&i.call(t,s)&&(n[s]=t[s]);return n};import{_ as c,j as d,M as f,l as m,y as u,a as p,b as g,h as y,N as h}from"./vendor.47d0e1ba.js";window.goLoadSearch=async()=>fetch("/api/search",{method:"POST"}).then((t=>t.text())),window.goLoadImage=async()=>fetch("/api/image",{method:"POST"}).then((t=>t.text())),window.goLoadConfig=async()=>fetch("/api/image",{method:"POST"}).then((t=>t.text()));const v={unicode:c.list(c.string()),categories:c.list(c.string()),description:c.object().additionalProperties(c.string()),tag:c.list(c.string())},w=c.shape(v);let b,j;async function N(){return b=b||c.object().additionalProperties(w).ensure(d.load(await window.goLoadSearch())),b}let O="https://cdn.jsdelivr.net/gh/patarapolw/emojazz/packages/nodejs/assets";async function S(){if(void 0===j){j=c.object().additionalProperties(c.list(c.string())).ensure(d.load(await window.goLoadImage()));const t=await window.goLoadConfig();O=((t.trim()?d.load(t).assetURL:"")||O).replace(/\/$/,""),document.head.prepend(Object.assign(document.createElement("style"),{innerHTML:`\n      @font-face {\n        font-family: 'noto';\n        src: url('${O}/fonts/NotoSans-Regular.ttf');\n      }\n    \n      @font-face {\n        font-family: 'noto-sc';\n        src: url('${O}/fonts/NotoSansCJKsc-Regular.otf');\n      }\n    \n      @font-face {\n        font-family: 'noto-tc';\n        src: url('${O}/fonts/NotoSansCJKtc-Regular.otf');\n      }\n    \n      @font-face {\n        font-family: 'noto-jp';\n        src: url('${O}/fonts/NotoSansCJKjp-Regular.otf');\n      }\n    \n      @font-face {\n        font-family: 'Noto Color Emoji';\n        src: url('${O}/fonts/NotoColorEmoji.ttf');\n      }\n      `}))}return O}async function x(t){const o=(await N())[t.id];return o?(await S(),a=r({},o),i={images:j[t.id].map((t=>O+t))||[]},e(a,n(i))):null;var a,i}const C={fields:["id","u","c","d","t"],storeFields:["id"],searchOptions:{boost:{t:5,c:2},prefix:!0,combineWith:"AND"}};let P;async function k(){const t=await N();void 0===P&&(P=new f(C),await P.addAllAsync(Object.entries(t).map((([t,e])=>({id:t,u:e.unicode,c:e.categories,d:Object.values(e.description).join("\n"),t:e.tag})))))}function I(){const[t,e]=m([]),[n,o]=m(""),[a,i]=m(1),[s,c]=m(0),[d,f]=m(!1),[h,v]=m(!1),[w,b]=m(""),[j,O]=m({images:[]}),[C,I]=m("Noto Color Emoji"),[T,E]=m(C),R=y(),$=(t={})=>{h?setTimeout((()=>{$(t)}),500):(v(!0),(async()=>{n.trimStart()||(i(1),e([]));const o=await async function(t){let{q:e=""}=t;if(e=e.trimLeft(),!e)return{result:[],count:0};const n=await N();await k();const{page:o=1,limit:a=50}=t,i=P.search(e);return{result:i.map((t=>r({text:t.id},n[t.id]))).slice((o-1)*a,o*a),count:i.length}}({q:n,page:a,limit:100});console.log(o),o.count||(i(1),e([]));const s=[...t.prev||[],...o.result];if(e(s),c(o.count),t.prev){const e=new Set(t.prev),n=o.result.filter((t=>e.has(t.text)));n.length&&console.error("Duplicates: ",n)}})().finally((()=>{v(!1)})))};return u((()=>{$()}),[n]),u((()=>{$({prev:t})}),[a]),u((()=>{const e=R.current;e&&(e.onscroll=()=>{t.length<s&&e.scrollHeight-e.scrollTop-e.clientHeight<50&&i(a+1)},e.scrollHeight<=e.clientHeight&&(e.scrollTop=0,i(1)))}),[a,t]),u((()=>{w&&x({id:w}).then((t=>{O(t||{images:[]})}))}),[w]),u((()=>{Promise.all([S(),k()]).then((()=>{f(!0)})),window.onkeydown=t=>{"Escape"===t.code&&b("")}})),p(g,null,p("form",{className:"search",onSubmit:async t=>{t.preventDefault()}},p("input",{type:"search",name:"q",id:"q",value:n,onInput:t=>o(t.target.value)})),p("div",{className:"container",ref:R},t.length?t.map((t=>{var e=t,{text:n}=e,o=l(e,["text"]);return p("div",{className:"emoji",title:L(o),onClick:()=>{E(C),b(n)}},n)})):1===a?p("div",{class:"nothing"},"Nothing here ðŸ¤£ðŸ¤£ðŸ¤£"):null),d?null:p("div",{className:"modal-container",style:{backgroundColor:"#88888833"}},p("div",{className:"spin"})),w?p("div",{className:"modal-container",onClick:()=>b("")},p("div",{className:"modal",onClick:t=>t.stopPropagation()},p("button",{className:"delete",type:"button",onClick:()=>b("")},p("div",{className:"emoji"},"âœ•")),p("div",{className:"row",style:{alignItems:"center"}},p("span",{style:{fontSize:"1.3em"}},"Text:"),p("span",{className:"entry",style:{fontFamily:C}},w)),p("div",{className:"row"},j.images.map((t=>p("div",{className:"entry",title:"Right click to copy the image"},p("img",{src:t,alt:t}))))),p("form",{className:"row font",onSubmit:async t=>{t.preventDefault(),I(T)},style:{alignItems:"center"}},p("label",{for:"font",style:{fontSize:"1.3em"}},"Font:"),p("input",{type:"text",name:"font",id:"font",value:T,onInput:t=>E(t.target.value),placeholder:"Set alternate font here"}),p("div",{style:{position:"relative"}},p("button",{type:"submit"},"âœ…"))),p("pre",{className:"row",style:{textAlign:"left"}},(t=>{var e=t,{images:n}=e;return L(l(e,["images"]))})(j)))):null)}function L(t){return d.dump(t,{replacer:(t,e)=>{if(String(e))return e},skipInvalid:!0})}h(p(I,null),document.getElementById("app"));
